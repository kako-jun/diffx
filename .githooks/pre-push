#!/bin/bash
# Pre-push hook to ensure code quality before pushing
# This mimics the CI environment exactly

set -e

# Get the current branch name
current_branch=$(git rev-parse --abbrev-ref HEAD)

echo "🔍 Running pre-push validation..."
echo "=================================="
echo "Current branch: $current_branch"

# Skip pre-push validation for main branch (direct pushes to main are allowed)
if [ "$current_branch" = "main" ]; then
    echo "ℹ️  Skipping pre-push validation for main branch"
    echo "   Main branch pushes are allowed without validation"
    echo "   (GitHub branch protection will handle final validation)"
    exit 0
fi

# Check if we're in the correct directory
if [ ! -f "scripts/ci-local.sh" ]; then
    echo "❌ Error: scripts/ci-local.sh not found"
    echo "Make sure you're in the diffx project root directory"
    exit 1
fi

# Run the same checks as CI for feature branches
echo "📋 Running CI validation script..."
./scripts/ci-local.sh

echo ""
echo "✅ Pre-push validation completed successfully!"
echo "Your code is ready to be pushed. 🚀"