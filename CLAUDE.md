# diffx の思想（Philosophy）
「構造化された差分を、誰でも、どこでも、簡単に」
従来の diff はテキストベースで、構造を理解できない。
diffx は JSON/YAML/TOMLなどの構造化データに特化した差分抽出ツール。
人間にもAIにもわかりやすい出力を提供し、設定ファイル・構成ファイル・データの変更を明確に可視化する。

# 🚨 重要な開発ルール (Important Development Rules)

## プッシュ前の必須チェック (Pre-Push Requirements)
**必ずプッシュ前に以下を実行すること:**
```bash
./scripts/ci-local.sh
```

- このスクリプトはGitHub Actions CIと完全に同じ環境・パラメータで実行される
- 1つでもエラーが発生したら即座に停止する（`set -e`）
- フォーマット・Clippy・ビルド・テスト・CLI動作確認をすべて実行
- ローカルで成功 → GitHub CIでも成功が保証される
- CI失敗によるプッシュのやり直しを防げる

## 名前「diffx」に込めた意味
diff + x の「x」は何を意味するか？

- **extended** 拡張された差分（構造化、意味的）
- **exact** 正確な差分抽出
- **flexible** 柔軟なフォーマット対応
- **indexed** 差分にインデックスを付けて追跡可能
- **next-gen** 次世代の差分ツール

# diffx の仕様（Specification）

## 対応フォーマット
JSON, YAML, TOML, XML, INI, CSV

## 差分の種類
- キーの追加・削除
- 値の変更
- 配列の挿入・削除・変更
- ネスト構造の差分

## 出力形式
- **diffx形式 (デフォルト)**: セマンティック差分形式
- **JSON/YAML形式**: 機械可読な形式
- **diff互換形式**: 既存ツールとの連携用

# diffx の提供形態

## 1. Rust Crate（diffx-core）
構造化差分抽出のロジックをライブラリとして提供
- **✅ 実装済み** - 包括的なテストケース付き

## 2. CLIツール（diffx）
ユーザーが直接使えるコマンドラインツール
- **✅ 実装済み** - 全ての基本機能が動作

## 3. 他言語向けラッパー（npm/pip）
- **npmパッケージ（diffx-js）**: Node.js環境からCLI呼び出し
- **pipパッケージ（diffx-python）**: Python環境からCLI呼び出し
- **✅ 実装済み**

# 📈 現在の実装進捗

## 🎯 総合進捗: **100%完了** 🎉

### ✅ 完全実装済み機能
1. **基本差分抽出** - 4種類の差分（追加/削除/変更/型変更）
2. **全フォーマット対応** - JSON/YAML/TOML/XML/INI/CSV
3. **ファイル拡張子自動判別** - 拡張子から自動的にフォーマット推論
4. **標準入力対応** - パイプ経由でのデータ読み込み
5. **ディレクトリ比較** - 再帰的なディレクトリ比較
6. **正規表現キー無視** - 特定パターンのキーを差分から除外
7. **配列要素識別** - 配列内オブジェクトの一意識別子による追跡
8. **数値許容誤差** - 浮動小数点数の微小差を無視
9. **型変更検出** - 数値⇔文字列の型変換を明確に報告
10. **パスフィルタリング** - 特定パスの差分のみ表示
11. **パフォーマンス最適化** - --optimize フラグによる高速モード
12. **出力形式** - CLI/JSON/YAML/Unified形式対応
13. **高需要オプション** - --context, --ignore-whitespace, --ignore-case, --quiet, --brief

### 🏗️ 技術的完成度
- **コアライブラリ**: 完全実装済み（42のユニットテストケース付き）
- **CLIツール**: 全機能動作確認済み（97の統合テストケース付き）
- **テスト総数**: 139テスト成功（100%パス率）
- **ベンチマーク**: criterionを使用したパフォーマンステスト
- **3言語エコシステム**: Rust/JavaScript/Python完全対応

## 🎉 最新完了作業 (2025-07-10)

### 🚀 高需要CLIオプション実装完了
- **新オプション追加**: --context, --ignore-whitespace, --ignore-case, --quiet, --brief
- **batch-size削除**: --optimizeに統合、自動判定機能として改良
- **UNIX互換性**: diff -q, -i, -w, -C3 相当の機能実装
- **CI/CD最適化**: プッシュ前の自動検証（97テスト成功）

### 📦 Python・JavaScript API更新
- **Python パッケージ**: DiffOptionsクラス更新、新オプション完全対応
- **JavaScript パッケージ**: 新APIライブラリ（lib.js）作成、非同期対応
- **テストカバレッジ**: 新オプションの包括的テストケース追加
- **API統一**: 3言語エコシステム完全同期

## ⚠️ 設定ファイル・環境変数サポート削除 (2025-07-10)

- **削除理由**: UNIX哲学の遵守、シンプルなCLI設計重視
- **削除機能**: ~/.config/diffx/config.toml、環境変数サポート
- **影響**: コア機能維持、CLI引数のみの簡素化




## 🌏 多言語対応 & ドキュメント

- **3言語対応**: 英語・日本語・中国語（13ページ、約8,000行）
- **包括的ドキュメント**: UNIX互換、CI/CD統合例、高度な使用例
- **リアルタイムテスト**: ドキュメント例とテストケースの1:1対応

## 🎯 プロジェクト完成宣言

**diffx は設計・実装・テスト・ドキュメント化・マルチプラットフォーム公開が完了し、本番環境での使用準備が整いました。**

### 🏆 達成した目標
- 構造化データの差分抽出における業界最高水準の機能性
- Rust言語の安全性とパフォーマンスを最大限活用
- 全6フォーマット（JSON/YAML/TOML/XML/INI/CSV）完全対応
- 人間とAI両方に優しいCLI設計
- 拡張性の高いアーキテクチャ
- **3言語エコシステム対応完了** (Rust/JavaScript/Python)

# 🎯 次期開発計画 (v0.4.0以降)

## 🚀 Phase 1: エコシステム強化 - 最優先

### 1.1 コミュニティ活動・知名度向上 ⭐⭐⭐
- Reddit r/rust での diffx 紹介投稿
- Awesome Rust リスト追加申請  
- GitHub Pages による公式サイト開設
- Homebrew Formula 作成（macOS向け）

### 1.2 パフォーマンス最適化・検証 ⭐⭐
- 大容量ファイル（>100MB）でのメモリ使用量最適化
- 競合ツール（jq, yq, diff等）との性能比較データ作成
- CI/CDでのパフォーマンス回帰テスト追加

## 🌟 Phase 2: エコシステム拡張 - 中期目標

### 2.1 TUIモード実装 ⭐⭐
- `diffx-tui` インタラクティブモード開発
- サイドバイサイド表示、リアルタイムフィルタリング

### 2.2 Web API モード ⭐⭐
- `diffx serve` HTTP APIサーバーモード
- REST API、Swagger/OpenAPI仕様

### 2.3 IDE拡張開発 ⭐
- VS Code拡張 `diffx-vscode` 開発
- Language Server Protocol (LSP) 対応

## 🔬 Phase 3: 高度機能実装 - 長期目標

### 3.1 AI統合機能 ⭐
- 差分の自然言語要約生成
- 変更影響度の自動評価
- 設定ドリフトの自動修復提案

### 3.2 時系列差分分析 ⭐
- 3者間差分 (`--three-way`) 実装
- 時系列変更パターン分析
- 変更履歴の可視化

## 📋 即座に実行可能なタスク

### 🎯 今すぐできること:
1. **diffx形式の標準化推進** - ドキュメント統一、仕様明文化
2. **GitHub Issue/PR テンプレート作成** - コミュニティ貢献促進
3. **パフォーマンス回帰テスト追加** - CI/CDパイプライン強化
4. **crates.io公開メタデータ最適化** - 発見性向上

### 🎪 コミュニティ活動:
1. **Reddit r/rust 投稿** - プロジェクト紹介
2. **Awesome Rust リスト追加申請** - 知名度向上
3. **Rust Meetup発表** - ユーザーフィードバック収集

### 🏗️ インフラ強化:
1. **GitHub Pages サイト設定** - docs/ の自動公開
2. **Docker イメージ作成** - コンテナ環境対応
3. **Homebrew Formula 作成** - macOS ユーザー向け