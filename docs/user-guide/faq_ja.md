# diffx よくある質問 (FAQ)

このセクションでは、`diffx` に関するよくある質問とその回答を提供します。

## 一般的な質問

### Q: diffxとは何ですか？

A: `diffx` は、JSON、YAML、TOMLなどの構造化データ形式を比較するために設計されたコマンドラインツールです。従来のテキストベースの `diff` ツールとは異なり、`diffx` はデータの基盤となる構造とセマンティクスを理解し、空白やキーの順序などの表面的な違いではなく、意味のある変更に焦点を当てます。

### Q: diffxは通常の `diff` コマンドとどう違いますか？

A: 通常の `diff` コマンドは、テキストファイルを1行ずつ比較します。これは、基盤となるデータ構造が意味的に同一であっても、空白、キーの順序、コメントの変更に対して差分を報告することを意味します。一方、`diffx` は構造化データを解析し、実際の値とその関係を比較するため、非意味的な変更を無視します。

### Q: diffxはどのような構造化データ形式をサポートしていますか？

A: `diffx` はJSON、YAML、TOML、XML、INI、CSVの形式をサポートしています。

### Q: diffxはディレクトリの比較をサポートしていますか？

A: はい、`diffx` は `--recursive` オプションを使用して再帰的なディレクトリ比較をサポートしています。両方のディレクトリ内の対応するファイルを見つけて比較します。

## 使用方法に関する質問

### Q: diffxが入力フォーマットを推測できない場合、どのように指定できますか？

A: `--format` オプションを使用して、入力ファイルのフォーマットを `diffx` に明示的に伝えることができます。これは、標準入力から読み込む場合や、ファイルに非標準の拡張子が付いている場合に特に便利です。

```bash
cat my_data.json | diffx - other_data.json --format json
```

### Q: 特定のパスに差分をフィルタリングできますか？

A: はい、`--path` オプションを使用すると、指定されたデータパス内で発生する差分のみを表示するように出力をフィルタリングできます。例えば、`--path "config.users[0].name"` のように使用します。

### Q: 比較から特定のキーを無視するにはどうすればよいですか？

A: `--ignore-keys-regex` オプションを正規表現とともに使用して、比較中に無視すべきキーを指定できます。これは、タイムスタンプや一意のIDなど、頻繁に変更されるが意味的な比較には重要ではないフィールドに便利です。

```bash
diffx file1.json file2.json --ignore-keys-regex "^id$|^timestamp$"
```

### Q: diffxは浮動小数点数の比較をどのように処理しますか？

A: `diffx` は、浮動小数点数の比較に許容誤差を指定するための `--epsilon` オプションを提供します。2つの数値間の絶対差がイプシロン値以下の場合、それらは等しいと見なされます。

```bash
diffx data1.json data2.json --epsilon 0.00001
```

### Q: diffxは配列要素をどのように比較しますか？特に順序が変更された場合。

A: デフォルトでは、`diffx` は配列要素をインデックスで比較します。ただし、オブジェクトの配列の場合、`--array-id-key` オプションを使用して、配列内の各オブジェクトを一意に識別するキーを指定できます。これにより、順序が変更されても、`diffx` は配列要素の追加、削除、変更を正しく追跡できます。

```bash
diffx users1.json users2.json --array-id-key "uuid"
```

## 技術的な質問

### Q: diffxが使用している基盤技術は何ですか？

A: `diffx` はRustで構築されており、そのパフォーマンス、メモリ安全性、クロスプラットフォーム機能を活用しています。解析には `serde_json`、`serde_yml`、`toml`、`configparser`、`quick-xml`、`csv` を、CLI出力には `colored` を、Unified diff出力には `similar` を使用しています。

### Q: なぜTOML出力は完全にサポートされていないのですか？

A: TOMLはJSONやYAMLと比較して、より厳格な型システムを持っています。柔軟な `DiffResult` enum（様々なデータ型を含むことができる）を、情報損失や複雑な回避策なしにTOML互換の構造に直接シリアライズすることは困難です。`diffx` はTOMLを解析できますが、データ劣化を避けるため、差分結果をTOMLとして出力することは現在完全にサポートされていません。

### Q: diffxをCI/CDパイプラインで使用できますか？

A: はい、`diffx` はCI/CDパイプラインに簡単に統合できるように設計されています。設定ファイルやデータの構造的な変更を自動的にチェックするために使用できます。詳細については、[CI/CD統合例](ci-cd.md)を参照してください。

### Q: diffxにおける「メタチェイニング」とは何ですか？

A: メタチェイニングとは、`diffx` が自身の出力を比較できる高度な機能を指します。`diffx` のJSONまたはYAML出力（2つのファイル間の差分を表す）をファイルに保存し、その「差分レポート」自体を `diffx` で再度比較できます。これにより、変更履歴の追跡、設定の監査、またはシステムの進化をメタレベルで分析できます。
